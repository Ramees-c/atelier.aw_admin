<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Edit News - Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <div class="admin-wrapper">
      <!-- ========== SIDEBAR ========== -->
      <aside class="sidebar">
        <div class="sidebar-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ATELIER<span>.AW</span></h5>
          <button type="button" class="btn-close btn-close-white d-md-none" id="sidebarClose" aria-label="Close"></button>
        </div>

        <ul class="sidebar-menu">
          <li><a href="index.html"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
          <li><a href="adminproject.html"><i class="bi bi-kanban"></i> Projects</a></li>
          <li class="active"><a href="admin_news.html"><i class="bi bi-newspaper"></i> News</a></li>
          <li><a href="admin_gallery.html"><i class="bi bi-images"></i> Gallery</a></li>
          <li><a href="admin_category.html"><i class="bi bi-tags"></i> Categories</a></li>
          <li class="logout-item"><a href="#"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
        </ul>
      </aside>

      <!-- ========== MAIN CONTENT ========== -->
      <main class="main-content">
        <!-- Topbar -->
        <nav class="topbar">
          <button class="btn btn-light d-md-none" id="menuToggle"><i class="bi bi-list"></i></button>
        </nav>

        <!-- Content -->
        <div class="container-fluid py-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">Edit News</h2>
            <a href="admin_news.html" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back</a>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-body p-4">
              <form class="needs-validation" novalidate>
                <div class="mb-3">
                  <label for="newsTitle" class="form-label">News Title</label>
                  <input type="text" class="form-control" id="newsTitle" placeholder="Enter news title" value="New Design Awards" required>
                  <div class="invalid-feedback">Please provide a news title.</div>
                </div>

                <div class="mb-3">
                  <label for="newsDesc" class="form-label">Description</label>
                  <textarea class="form-control" id="newsDesc" rows="5" placeholder="Enter news description" required>Atelier.AW wins prestigious design award...</textarea>
                  <div class="invalid-feedback">Please provide a news description.</div>
                </div>

                <div class="mb-4">
                  <label for="newsImage" class="form-label">News Image</label>
                  <input type="file" class="form-control" id="newsImage" accept="image/*">
                  <div class="mt-2" id="currentNewsImageContainer">
                    <small class="text-muted d-block mb-2">Current Image:</small>
                    <div class="preview-item">
                        <img src="https://via.placeholder.com/120" alt="Current News Image">
                    </div>
                  </div>
                  <div id="newsPreviewContainer" class="image-preview-container"></div>
                </div>

                <button type="submit" class="btn btn-theme px-4">Update News</button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const toggle = document.getElementById("menuToggle");
      const closeBtn = document.getElementById("sidebarClose");
      const sidebar = document.querySelector(".sidebar");
      toggle.addEventListener("click", () => sidebar.classList.toggle("open"));
      closeBtn.addEventListener("click", () => sidebar.classList.remove("open"));

      // --- Image Preview Logic ---
      document.addEventListener('DOMContentLoaded', function() {
        const newsInput = document.getElementById('newsImage');
        const newsPreviewContainer = document.getElementById('newsPreviewContainer');
        const currentNewsImageContainer = document.getElementById('currentNewsImageContainer');

        newsInput.addEventListener('change', function() {
            newsPreviewContainer.innerHTML = ''; // Clear previous preview
            if (this.files && this.files[0]) {
                if (currentNewsImageContainer) currentNewsImageContainer.style.display = 'none';
                const file = this.files[0];
                if (file.size > 1048576) {
                    Swal.fire({
                        icon: 'error',
                        title: 'File Too Large',
                        text: 'News image must be less than 1MB.',
                        confirmButtonText: 'OK',
                        customClass: { confirmButton: 'btn btn-theme' },
                        buttonsStyling: false
                    });
                    this.value = '';
                    if (currentNewsImageContainer) currentNewsImageContainer.style.display = 'block';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;

                    img.onload = function() {
                        if (this.width <= this.height) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Invalid Orientation',
                                text: 'News image must be landscape (width > height).',
                                confirmButtonText: 'OK',
                                customClass: { confirmButton: 'btn btn-theme' },
                                buttonsStyling: false
                            });
                            newsInput.value = '';
                            if (currentNewsImageContainer) currentNewsImageContainer.style.display = 'block';
                            return;
                        }

                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        const previewImg = document.createElement('img');
                        previewImg.src = e.target.result;
                        previewItem.appendChild(previewImg);
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '&times;';
                        removeBtn.title = 'Remove image';
                        removeBtn.onclick = function() {
                            previewItem.remove();
                            newsInput.value = ''; // Reset the file input
                            if (currentNewsImageContainer) currentNewsImageContainer.style.display = 'block';
                        };
                        previewItem.appendChild(removeBtn);
                        newsPreviewContainer.appendChild(previewItem);
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // --- Form Validation & Submit Simulation ---
        const form = document.querySelector('.needs-validation');
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            } else {
                event.preventDefault(); // Prevent actual submission for demo

                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;

                // Set loading state
                btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Updating...';
                btn.disabled = true;

                // Simulate saving process
                setTimeout(() => {
                    Swal.fire({
                        title: 'Success!',
                        text: 'News Updated Successfully!',
                        icon: 'success',
                        confirmButtonText: 'Great!',
                        customClass: { confirmButton: 'btn btn-theme' },
                        buttonsStyling: false
                    });
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    form.classList.remove('was-validated');
                }, 1500);
            }

            form.classList.add('was-validated');
        }, false);

        // Logout Confirmation
        const logoutBtn = document.querySelector(".logout-item a");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Logout?",
              text: "Are you sure you want to logout?",
              icon: "warning",
              showCancelButton: true,
              confirmButtonColor: "#dc3545",
              cancelButtonColor: "#6c757d",
              confirmButtonText: "Yes, Logout",
            }).then((result) => {
              if (result.isConfirmed) {
                window.location.href = "login.html";
              }
            });
          });
        }
      });
    </script>
  </body>
</html>