<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Project - Admin Panel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <div class="admin-wrapper">
      <!-- ========== SIDEBAR ========== -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <a href="index.html" class="sidebar-brand">
            <img src="assets/brand_logo_white.png" alt="ATELIER.AW Logo">
          </a>
          <button type="button" class="btn-close btn-close-white d-md-none" id="sidebarClose" aria-label="Close"></button>
        </div>

        <ul class="sidebar-menu">
          <li><a href="index.html"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
          <li class="active"><a href="adminproject.html"><i class="bi bi-kanban"></i> Projects</a></li>
          <li><a href="admin_news.html"><i class="bi bi-newspaper"></i> News</a></li>
          <li><a href="admin_gallery.html"><i class="bi bi-images"></i> Gallery</a></li>
          <li><a href="admin_category.html"><i class="bi bi-tags"></i> Categories</a></li>
          <li class="logout-item"><a href="#"><i class="bi bi-box-arrow-right"></i> Logout</a></li>
        </ul>
      </aside>

      <!-- ========== MAIN CONTENT ========== -->
      <main class="main-content">
        <!-- Topbar -->
        <nav class="topbar">
          <button class="btn btn-light d-md-none" id="menuToggle"><i class="bi bi-list"></i></button>
        </nav>

        <!-- Content -->
        <div class="container-fluid py-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="fw-bold">Edit Project</h2>
            <a href="adminproject.html" class="btn btn-outline-secondary"><i class="bi bi-arrow-left"></i> Back</a>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-body p-4">
              <form class="needs-validation" novalidate>
                <div class="mb-3">
                  <label for="projectTitle" class="form-label">Project Title</label>
                  <input type="text" class="form-control" id="projectTitle" placeholder="Enter project title" value="Luxury Apartment" required>
                  <div class="invalid-feedback">Please provide a project title.</div>
                </div>

                <div class="mb-3">
                  <label for="projectDesc" class="form-label">Description</label>
                  <textarea class="form-control" id="projectDesc" rows="5" placeholder="Enter project description" required>High-end interior design for a penthouse...</textarea>
                  <div class="invalid-feedback">Please provide a project description.</div>
                </div>

                <div class="mb-3">
                  <label for="projectLocation" class="form-label">Location</label>
                  <input type="text" class="form-control" id="projectLocation" placeholder="Enter project location" value="New York, USA" required>
                  <div class="invalid-feedback">Please provide the project location.</div>
                </div>

                <div class="mb-3">
                  <label for="principalArchitect" class="form-label">Principal Architect</label>
                  <input type="text" class="form-control" id="principalArchitect" placeholder="Enter architect's name" value="John Doe" required>
                  <div class="invalid-feedback">Please provide the principal architect's name.</div>
                </div>

                <div class="mb-3">
                  <label for="projectYear" class="form-label">Year</label>
                  <input type="number" class="form-control" id="projectYear" placeholder="Enter project year" value="2023" required>
                  <div class="invalid-feedback">Please provide the project year.</div>
                </div>

                <div class="mb-3">
                  <label for="projectArea" class="form-label">Area (sq. ft.)</label>
                  <input type="number" step="any" class="form-control" id="projectArea" placeholder="Enter project area" value="2500.5" required>
                  <div class="invalid-feedback">Please provide the project area.</div>
                </div>

                <div class="mb-3">
                  <label for="projectCategory" class="form-label">Category</label>
                  <select class="form-select" id="projectCategory" required>
                    <option value="" disabled>Choose a category...</option>
                    <option value="Interior" selected>Interior</option>
                    <option value="Architecture">Architecture</option>
                    <option value="Exterior">Exterior</option>
                    <option value="Furniture">Furniture</option>
                  </select>
                  <div class="invalid-feedback">Please select a category.</div>
                </div>

                <div class="mb-3">
                  <label for="bannerImage" class="form-label">Banner Image (Card View)</label>
                  <input type="file" class="form-control" id="bannerImage" accept="image/*">
                  <div class="mt-2" id="currentBannerContainer">
                    <small class="text-muted d-block mb-2">Current Image:</small>
                    <div class="preview-item">
                        <img src="https://via.placeholder.com/120" alt="Current Banner">
                        <button type="button" class="remove-btn" onclick="this.parentElement.remove()">&times;</button>
                    </div>
                  </div>
                  <div id="bannerPreviewContainer" class="image-preview-container"></div>
                </div>

                <div class="mb-3">
                  <label for="galleryImages" class="form-label">Project Gallery (Multiple Images)</label>
                  <input type="file" class="form-control" id="galleryImages" multiple accept="image/*">
                  <div class="mt-2">
                    <small class="text-muted d-block mb-2">Gallery Images:</small>
                    <div id="galleryPreviewContainer" class="image-preview-container mt-0">
                        <div class="preview-item existing-item">
                          <img src="https://via.placeholder.com/120" alt="Gallery 1">
                          <button type="button" class="remove-btn" onclick="this.parentElement.remove()">&times;</button>
                        </div>
                        <div class="preview-item existing-item">
                          <img src="https://via.placeholder.com/120" alt="Gallery 2">
                          <button type="button" class="remove-btn" onclick="this.parentElement.remove()">&times;</button>
                        </div>
                    </div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="videoUrl" class="form-label">YouTube Video URL</label>
                  <input type="url" class="form-control" id="videoUrl" placeholder="https://youtube.com/..." value="https://youtube.com/watch?v=example">
                </div>

                <div class="mb-4">
                  <label for="pdfUpload" class="form-label">Upload PDF</label>
                  <input type="file" class="form-control" id="pdfUpload" accept=".pdf">
                  <div class="form-text">Current file: project_specs.pdf</div>
                </div>

                <button type="submit" class="btn btn-theme px-4">Update Project</button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const toggle = document.getElementById("menuToggle");
      const closeBtn = document.getElementById("sidebarClose");
      const sidebar = document.querySelector(".sidebar");
      toggle.addEventListener("click", () => sidebar.classList.toggle("open"));
      closeBtn.addEventListener("click", () => sidebar.classList.remove("open"));

      // --- Image Preview Logic (For New Uploads) ---
      document.addEventListener('DOMContentLoaded', function() {
        const bannerInput = document.getElementById('bannerImage');
        const bannerPreviewContainer = document.getElementById('bannerPreviewContainer');
        const currentBannerContainer = document.getElementById('currentBannerContainer');

        bannerInput.addEventListener('change', function() {
            bannerPreviewContainer.innerHTML = '';
            if (this.files && this.files[0]) {
                if (currentBannerContainer) currentBannerContainer.style.display = 'none';
                const file = this.files[0];
                if (file.size > 1048576) {
                    Swal.fire({
                        icon: 'error',
                        title: 'File Too Large',
                        text: 'Banner image must be less than 1MB.',
                        confirmButtonText: 'OK',
                        customClass: { confirmButton: 'btn btn-theme' },
                        buttonsStyling: false
                    });
                    this.value = '';
                    if (currentBannerContainer) currentBannerContainer.style.display = 'block';
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;

                    img.onload = function() {
                        if (this.width <= this.height) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Invalid Orientation',
                                text: 'Banner image must be landscape (width > height).',
                                confirmButtonText: 'OK',
                                customClass: { confirmButton: 'btn btn-theme' },
                                buttonsStyling: false
                            });
                            bannerInput.value = '';
                            if (currentBannerContainer) currentBannerContainer.style.display = 'block';
                            return;
                        }

                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        const previewImg = document.createElement('img');
                        previewImg.src = e.target.result;
                        previewItem.appendChild(previewImg);
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'remove-btn';
                        removeBtn.innerHTML = '&times;';
                        removeBtn.onclick = function() { 
                            previewItem.remove(); 
                            bannerInput.value = '';
                            if (currentBannerContainer) currentBannerContainer.style.display = 'block';
                        };
                        previewItem.appendChild(removeBtn);
                        bannerPreviewContainer.appendChild(previewItem);
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        // --- Gallery Images Preview (Multiple & Accumulate) ---
        const galleryInput = document.getElementById('galleryImages');
        const galleryPreviewContainer = document.getElementById('galleryPreviewContainer');
        let galleryItems = [];

        galleryInput.addEventListener('change', function() {
            const newFiles = Array.from(this.files);
            
            const filePromises = newFiles.map(file => {
                return new Promise((resolve, reject) => {
                    if (file.size > 1048576) {
                        Swal.fire({
                            icon: 'error',
                            title: 'File Too Large',
                            text: `Image "${file.name}" exceeds 1MB and was skipped.`,
                            confirmButtonText: 'OK',
                            customClass: { confirmButton: 'btn btn-theme' },
                            buttonsStyling: false
                        });
                        resolve(null);
                        return;
                    }
                    // Prevent adding duplicates
                    if (galleryItems.some(item => item.file.name === file.name && item.file.size === file.size)) {
                        resolve(null);
                        return;
                    }
                    const reader = new FileReader();
                    reader.onload = e => resolve({ file: file, dataURL: e.target.result });
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            });

            Promise.all(filePromises).then(newItems => {
                galleryItems.push(...newItems.filter(item => item !== null));
                updateFileInput();
                renderGalleryPreviews();
            });
        });

        function updateFileInput() {
            const dataTransfer = new DataTransfer();
            galleryItems.forEach(item => dataTransfer.items.add(item.file));
            galleryInput.files = dataTransfer.files;
        }

        function renderGalleryPreviews() {
            // Preserve existing items that haven't been removed
            const existingItems = Array.from(galleryPreviewContainer.querySelectorAll('.existing-item'));
            
            galleryPreviewContainer.innerHTML = '';
            
            // Re-append existing items
            existingItems.forEach(item => galleryPreviewContainer.appendChild(item));
            
            galleryItems.forEach((item, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                const img = document.createElement('img');
                img.src = item.dataURL;
                previewItem.appendChild(img);
                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '&times;';
                removeBtn.onclick = function() {
                    galleryItems.splice(index, 1);
                    updateFileInput();
                    renderGalleryPreviews();
                };
                previewItem.appendChild(removeBtn);
                galleryPreviewContainer.appendChild(previewItem);
            });
        }

        // --- Form Validation & Submit Simulation ---
        const form = document.querySelector('.needs-validation');
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            } else {
                event.preventDefault();
                const btn = form.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Updating...';
                btn.disabled = true;

                setTimeout(() => {
                    Swal.fire({
                        title: 'Success!',
                        text: 'Project Updated Successfully!',
                        icon: 'success',
                        confirmButtonText: 'Great!',
                        customClass: { confirmButton: 'btn btn-theme' },
                        buttonsStyling: false
                    });
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    form.classList.remove('was-validated');
                    galleryPreviewContainer.innerHTML = '';
                    galleryItems = [];
                }, 1500);
            }
            form.classList.add('was-validated');
        }, false);

        // Logout Confirmation
        const logoutBtn = document.querySelector(".logout-item a");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", (e) => {
            e.preventDefault();
            Swal.fire({
              title: "Logout?",
              text: "Are you sure you want to logout?",
              icon: "warning",
              showCancelButton: true,
              confirmButtonColor: "#dc3545",
              cancelButtonColor: "#6c757d",
              confirmButtonText: "Yes, Logout",
            }).then((result) => {
              if (result.isConfirmed) {
                window.location.href = "login.html";
              }
            });
          });
        }
      });
    </script>
  </body>
</html>